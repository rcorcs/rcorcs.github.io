function character(){this.pos={x:0,y:0};this.angle=0;this.move=__character_move;this.face=__character_face;this.direction=__character_direction;this.paint=__character_paint}function __character_direction(e){var t=0;var n=0;var r=this.angle;while(r>2*Math.PI){r=r-2*Math.PI}if(r==0){t=e;n=0}else if(r==Math.PI/2){t=0;n=e}else if(r==Math.PI){t=-e;n=0}else if(r==3*Math.PI/2){t=0;n=-e}else{t=Math.cos(this.angle)*e;n=Math.sin(this.angle)*e}var i={x:t,y:n};return i}function __character_move(e){var t=this.direction(e);this.pos.x=this.pos.x+t.x;this.pos.y=this.pos.y+t.y}function __character_face(e){var t=e.x-this.pos.x;var n=e.y-this.pos.y;if(t==0){if(n>=0){this.angle=Math.PI/2}else{this.angle=3*Math.PI/2}}else if(n==0){if(t>=0){this.angle=0}else{this.angle=Math.PI}}else{this.angle=Math.atan(Math.abs(n)/Math.abs(t));if(t<0&&n>0){this.angle=Math.PI-this.angle}else if(t>0&&n<0){this.angle=2*Math.PI-this.angle}else if(t<0&&n<0){this.angle=Math.PI+this.angle}while(this.angle>2*Math.PI){this.angle=this.angle-2*Math.PI}}}function __character_paint(e){var t=this.direction(15);e.context.beginPath();e.context.moveTo(this.pos.x,this.pos.y);e.context.lineTo(this.pos.x+t.x,this.pos.y+t.y);e.context.stroke();e.context.fillStyle="#f00";e.context.beginPath();e.context.arc(this.pos.x,this.pos.y,8,0,Math.PI*2,true);e.context.fill();e.context.beginPath();e.context.arc(this.pos.x,this.pos.y,8,0,Math.PI*2,true);e.context.stroke()}function gmap(){this.g=0;this.vert=new Array}function hexmap(e,t,n){this.width=e;this.height=t;this.distance=n;this.vert=new Array;this.g=new graph(this.height*this.width);for(var r=0;r<this.height;r++){for(var i=0;i<this.width;i++){if(r%2==0){this.vert[r*this.width+i]={x:this.distance/2+i*this.distance,y:this.distance/2+r*this.distance}}else{this.vert[r*this.width+i]={x:this.distance+i*this.distance,y:this.distance/2+r*this.distance}}}}for(var r=0;r<this.height;r++){for(var i=0;i<this.width;i++){if(r%2==0){if(i<this.width-1){this.g.add(r*this.width+i,r*this.width+i+1,1)}if(r<this.height-1){this.g.add(r*this.width+i,r*this.width+i+this.width,1);if(i>0){this.g.add(r*this.width+i,r*this.width+i+this.width-1,1)}}}else{if(i<this.width-1){this.g.add(r*this.width+i,r*this.width+i+1,1);if(r<this.height-1){this.g.add(r*this.width+i,r*this.width+i+this.width+1,1)}}if(r<this.height-1){this.g.add(r*this.width+i,r*this.width+i+this.width,1)}}}}this.get_vert_by_pos=function(e){var t=-1;var n=-1;for(var r=0;r<this.vert.length;r++){var i=distance(e,this.vert[r]);if(i<t||t==-1){t=i;n=r;if(t<this.distance/2){return n}}}return n};this.paint=function(e){this.paint_hex(e);this.paint_graph(e)};this.paint_hex=function(e){var t=this.distance/2;for(var n=0;n<this.vert.length;n++){e.context.fillStyle="rgba(0,255,0,0.1)";e.context.beginPath();e.context.moveTo(this.vert[n].x-t,this.vert[n].y-t/2);e.context.lineTo(this.vert[n].x-t,this.vert[n].y+t/2);e.context.lineTo(this.vert[n].x,this.vert[n].y+(t+t/2));e.context.lineTo(this.vert[n].x+t,this.vert[n].y+t/2);e.context.lineTo(this.vert[n].x+t,this.vert[n].y-t/2);e.context.lineTo(this.vert[n].x,this.vert[n].y-(t+t/2));e.context.closePath();e.context.fill();e.context.strokeStyle="rgba(0,255,0,0.5)";e.context.beginPath();e.context.moveTo(this.vert[n].x-t,this.vert[n].y-t/2);e.context.lineTo(this.vert[n].x-t,this.vert[n].y+t/2);e.context.lineTo(this.vert[n].x,this.vert[n].y+(t+t/2));e.context.lineTo(this.vert[n].x+t,this.vert[n].y+t/2);e.context.lineTo(this.vert[n].x+t,this.vert[n].y-t/2);e.context.lineTo(this.vert[n].x,this.vert[n].y-(t+t/2));e.context.closePath();e.context.stroke()}};this.paint_graph=function(e){e.context.strokeStyle="rgba(0,0,0, 0.5)";for(var t=0;t<this.vert.length;t++){var n=this.g.adj[t].head;while(n!=0){e.context.beginPath();e.context.moveTo(this.vert[n.val.v[0]].x,this.vert[n.val.v[0]].y);e.context.lineTo(this.vert[n.val.v[1]].x,this.vert[n.val.v[1]].y);e.context.stroke();n=n.next}}for(var t=0;t<this.vert.length;t++){e.context.fillStyle="rgba(255,0,0,0.5)";e.context.beginPath();e.context.arc(this.vert[t].x,this.vert[t].y,2,0,Math.PI*2,true);e.context.fill();e.context.strokeStyle="rgba(0,0,0, 0.5)";e.context.beginPath();e.context.arc(this.vert[t].x,this.vert[t].y,2,0,Math.PI*2,true);e.context.stroke()}};this.paint_path=function(e,t){e.context.strokeStyle="#f00";e.context.beginPath();var n=true;for(var r=t.head;r!=0;r=r.next){if(n){e.context.moveTo(this.vert[r.val].x,this.vert[r.val].y);n=false}else{e.context.lineTo(this.vert[r.val].x,this.vert[r.val].y)}}e.context.stroke()}}function canvas_2d(e){this.element=document.getElementById(e);this.context=this.element.getContext("2d");this.erase=__canvas_2d_erase;this.paint=function(){}}function __canvas_2d_erase(){this.element.width=this.element.width}function graph_edge(e,t,n){this.v=[e,t];this.weight=n}function graph(e,t){this.oriented=t;this.v=e;this.e=0;this.adj=new Array;for(var n=0;n<e;n++){this.adj[n]=new list}this.add=function(e,t,n){this.adj[e].addBack(this.adj[e].node(new graph_edge(e,t,n)));if(!this.oriented){this.adj[t].addBack(this.adj[t].node(new graph_edge(t,e,n)))}};this.remove=function(e,t){var n=this.adj[e].head;while(n!=0){if(n.val.v[1]==t){this.adj[e].remove(n);break}n=n.next}};this.edge=function(e,t){var n=this.adj[e].head;while(n!=0){if(n.val.v[1]==t){return n.val}n=n.next}return 0};this.neighbour=function(e){var t=new list;for(var n=this.adj[e].head;n!=0;n=n.next){t.addBack(t.node(n.val.v[1]))}return t};this.dijkstra=__graph_dijkstra}function __graph_min_dist(e,t,n){var r=-1;var i=-1;for(var s=0;s<n;s++){if((r<0||e[s]<r)&&e[s]>=0&&t[s]){r=e[s];i=s}}return i}function __graph_empty_set(e,t){for(var n=0;n<t;n++){if(e[n])return false}return true}function __graph_dijkstra(e,t){var n=new Array;var r=new Array;var i=new Array;for(var s=0;s<this.v;s++){n[s]=-1;r[s]=-1;i[s]=true}n[e]=0;while(!__graph_empty_set(i,this.v)){var o=__graph_min_dist(n,i,this.v);if(o==-1)break;i[o]=false;var u=this.neighbour(o);for(var a=u.head;a!=0;a=a.next){var f=n[o]+this.edge(o,a.val).weight;if(f<n[a.val]||n[a.val]<0){n[a.val]=f;r[a.val]=o}}}var l=t;var c=new list;while(l!=-1){c.addFront(c.node(l));l=r[l]}return c}function drawCircle(e,t,n,r){e.context.beginPath();e.context.arc(t,n,r,0,Math.PI*2,true)}function list_node(){this.val=0;this.next=0;this.prev=0}function list(){this.head=0;this.tail=0;this.node=__list_node;this.size=__list_size;this.clear=__list_clear;this.addFront=__list_addFront;this.addBack=__list_addBack;this.removeFront=__list_removeFront;this.removeBack=__list_removeBack;this.remove=__list_remove}function __list_node(e){var t=new list_node;t.val=e;return t}function __list_size(){var e=this.head;var t=0;while(e!=0){t+=1;e=e.next}return t}function __list_clear(){this.head=this.tail=0}function __list_addFront(e){if(this.head==0){e.next=0;e.prev=0;this.head=e;this.tail=e}else{e.next=this.head;e.prev=0;this.head.prev=e;this.head=e}}function __list_addBack(e){if(this.tail==0){e.next=0;e.prev=0;this.head=e;this.tail=e}else{e.prev=this.tail;e.next=0;this.tail.next=e;this.tail=e}}function __list_removeFront(){if(this.head!=0){var e=this.head;this.head=this.head.next;if(this.head!=0){this.head.prev=0}else this.tail=0;e.next=0;return e}else return 0}function __list_removeBack(){if(this.tail!=0){var e=this.tail;this.tail=this.tail.prev;if(this.tail!=0){this.tail.next=0}else this.head=0;e.prev=0;return e}else return 0}function __list_remove(e){var t=e.prev;var n=e.next;if(t!=0){t.next=e.next}else{this.head=e.next}if(n!=0){n.prev=e.prev}else{this.tail=e.prev}}function point(){this.x=0;this.y=0}function distance(e,t){return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))}function url_get_parameter(e){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var t="[\\?&]"+e+"=([^&#]*)";var n=new RegExp(t);var r=n.exec(window.location.href);if(r==null)return"";else return r[1]}function getWindowWidth(){var e=0;if(typeof window.innerWidth=="number"){e=window.innerWidth}else{if(document.documentElement&&document.documentElement.clientWidth){e=document.documentElement.clientWidth}else{if(document.body&&document.body.clientWidth){e=document.body.clientWidth}}}return e}function getWindowHeight(){var e=0;if(typeof window.innerHeight=="number"){e=window.innerHeight}else{if(document.documentElement&&document.documentElement.clientHeight){e=document.documentElement.clientHeight}else{if(document.body&&document.body.clientHeight){e=document.body.clientHeight}}}return e}
